/**
 * èŠå¤©è®°å½•æœç´¢é¡µ
 * åŠŸèƒ½ï¼šæœç´¢èŠå¤©å†…å®¹
 */
import router from '@ohos.router'

class SearchResult {
  id: number
  contactName: string
  content: string
  time: string

  constructor(id: number, contactName: string, content: string, time: string) {
    this.id = id
    this.contactName = contactName
    this.content = content
    this.time = time
  }
}

@Entry
@Component
struct SearchMessagePage {
  @State searchText: string = ''
  @State searchResults: SearchResult[] = []

  // æ‰§è¡Œæœç´¢
  handleSearch() {
    if (this.searchText.trim().length > 0) {
      // æ¨¡æ‹Ÿæœç´¢ç»“æœ
      this.searchResults = [
        new SearchResult(1, 'å¼ ä¸‰', 'æ™šä¸Šä¸€èµ·åƒé¥­å§', '2024-01-15 18:30'),
        new SearchResult(2, 'æå››', 'æ–‡ä»¶å·²å‘é€', '2024-01-14 15:10'),
      ]
    } else {
      this.searchResults = []
    }
  }

  @Builder
  SearchResultItem(result: SearchResult) {
    Column() {
      Row() {
        Text(result.contactName.substring(0, 1))
          .width(40)
          .height(40)
          .borderRadius(4)
          .backgroundColor('#07C160')
          .fontColor('#FFFFFF')
          .fontSize(16)
          .textAlign(TextAlign.Center)
          .margin({ right: 12 })

        Column() {
          Text(result.contactName)
            .fontSize(16)
            .fontWeight(FontWeight.Medium)
            .margin({ bottom: 4 })

          Text(result.content)
            .fontSize(14)
            .fontColor('#666666')
            .maxLines(1)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
        }
        .alignItems(HorizontalAlign.Start)
        .layoutWeight(1)

        Text(result.time)
          .fontSize(12)
          .fontColor('#999999')
      }
      .width('100%')
      .padding(16)
      .onClick(() => {
        router.pushUrl({ url: 'pages/ChatDetailPage' })
      })
    }
    .width('100%')
    .backgroundColor('#FFFFFF')
  }

  build() {
    Column() {
      // é¡¶éƒ¨æœç´¢æ 
      Row() {
        Image($r('sys.media.ohos_ic_public_arrow_left'))
          .width(24)
          .height(24)
          .margin({ right: 12 })
          .onClick(() => {
            router.back()
          })

        Row() {
          Image($r('sys.media.ohos_ic_public_search_filled'))
            .width(20)
            .height(20)
            .fillColor('#999999')
            .margin({ right: 8 })

          TextInput({ text: this.searchText, placeholder: 'æœç´¢èŠå¤©è®°å½•' })
            .layoutWeight(1)
            .backgroundColor('transparent')
            .onChange((value: string) => {
              this.searchText = value
              this.handleSearch()
            })
        }
        .layoutWeight(1)
        .height(36)
        .backgroundColor('#F5F5F5')
        .borderRadius(18)
        .padding({ left: 12, right: 12 })
      }
      .width('100%')
      .padding(12)
      .backgroundColor('#FFFFFF')

      // æœç´¢ç»“æœ
      if (this.searchResults.length > 0) {
        List() {
          ForEach(this.searchResults, (result: SearchResult) => {
            ListItem() {
              this.SearchResultItem(result)
            }
          })
        }
        .width('100%')
        .layoutWeight(1)
        .backgroundColor('#EDEDED')
        .divider({ strokeWidth: 1, color: '#EDEDED' })
      } else if (this.searchText.length > 0) {
        Column() {
          Text('æœªæ‰¾åˆ°ç›¸å…³èŠå¤©è®°å½•')
            .fontSize(16)
            .fontColor('#999999')
        }
        .width('100%')
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)
        .backgroundColor('#EDEDED')
      } else {
        Column() {
          Text('ğŸ”')
            .fontSize(60)
            .margin({ bottom: 16 })

          Text('æœç´¢èŠå¤©è®°å½•')
            .fontSize(16)
            .fontColor('#999999')
        }
        .width('100%')
        .layoutWeight(1)
        .justifyContent(FlexAlign.Center)
        .backgroundColor('#EDEDED')
      }
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#EDEDED')
  }
}
