/**
 * å‘å¸ƒåŠ¨æ€é¡µ
 * åŠŸèƒ½ï¼šå‘å¸ƒæœ‹å‹åœˆåŠ¨æ€
 */
import router from '@ohos.router'

@Entry
@Component
struct PublishMomentPage {
  @State content: string = ''
  @State selectedImages: string[] = []
  @State canPublish: boolean = false

  // æ£€æŸ¥æ˜¯å¦å¯ä»¥å‘å¸ƒ
  checkCanPublish() {
    this.canPublish = this.content.trim().length > 0 || this.selectedImages.length > 0
  }

  // å‘å¸ƒåŠ¨æ€
  publishMoment() {
    if (this.canPublish) {
      // å‘å¸ƒæˆåŠŸï¼Œè¿”å›æœ‹å‹åœˆ
      router.back()
    }
  }

  // é€‰æ‹©å›¾ç‰‡
  selectImage() {
    // æ¨¡æ‹Ÿé€‰æ‹©å›¾ç‰‡
    if (this.selectedImages.length < 9) {
      this.selectedImages.push('image.jpg')
      this.checkCanPublish()
    }
  }

  // åˆ é™¤å›¾ç‰‡
  removeImage(index: number) {
    this.selectedImages.splice(index, 1)
    this.checkCanPublish()
  }

  @Builder
  ImageItem(image: string, index: number) {
    Stack() {
      Text('ğŸ“·')
        .width('100%')
        .height('100%')
        .fontSize(40)
        .textAlign(TextAlign.Center)
        .backgroundColor('#F5F5F5')
        .borderRadius(8)

      // åˆ é™¤æŒ‰é’®
      Text('Ã—')
        .width(24)
        .height(24)
        .fontSize(20)
        .fontColor('#FFFFFF')
        .backgroundColor('#FF3B30')
        .borderRadius(12)
        .textAlign(TextAlign.Center)
        .position({ x: '85%', y: -8 })
        .onClick(() => {
          this.removeImage(index)
        })
    }
    .width(100)
    .height(100)
    .margin(8)
  }

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Text('å–æ¶ˆ')
          .fontSize(16)
          .fontColor('#666666')
          .onClick(() => {
            router.back()
          })

        Text('å‘è¡¨')
          .fontSize(18)
          .fontWeight(FontWeight.Medium)
          .layoutWeight(1)
          .textAlign(TextAlign.Center)

        Text('å‘å¸ƒ')
          .fontSize(16)
          .fontColor(this.canPublish ? '#07C160' : '#CCCCCC')
          .onClick(() => {
            this.publishMoment()
          })
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 16 })
      .backgroundColor('#FFFFFF')

      Scroll() {
        Column() {
          // æ–‡æœ¬è¾“å…¥åŒºåŸŸ
          TextArea({ text: this.content, placeholder: 'è¿™ä¸€åˆ»çš„æƒ³æ³•...' })
            .width('100%')
            .height(200)
            .fontSize(16)
            .backgroundColor('#FFFFFF')
            .onChange((value: string) => {
              this.content = value
              this.checkCanPublish()
            })

          // å›¾ç‰‡ç½‘æ ¼
          Column() {
            Grid() {
              ForEach(this.selectedImages, (image: string, index: number) => {
                GridItem() {
                  this.ImageItem(image, index)
                }
              })

              // æ·»åŠ å›¾ç‰‡æŒ‰é’®
              if (this.selectedImages.length < 9) {
                GridItem() {
                  Column() {
                    Text('+')
                      .width(40)
                      .height(40)
                      .fontSize(32)
                      .fontColor('#999999')
                      .textAlign(TextAlign.Center)
                  }
                  .width(100)
                  .height(100)
                  .margin(8)
                  .backgroundColor('#F5F5F5')
                  .borderRadius(8)
                  .justifyContent(FlexAlign.Center)
                  .onClick(() => {
                    this.selectImage()
                  })
                }
              }
            }
            .columnsTemplate('1fr 1fr 1fr')
            .width('100%')
            .padding(8)
          }
          .width('100%')
          .margin({ top: 16 })

          // åŠŸèƒ½é€‰é¡¹
          Column() {
            Row() {
              Text('æ‰€åœ¨ä½ç½®')
                .fontSize(16)
                .layoutWeight(1)

              Text('ä¸æ˜¾ç¤º')
                .fontSize(16)
                .fontColor('#999999')
                .margin({ right: 8 })

              Image($r('sys.media.ohos_ic_public_arrow_right'))
                .width(20)
                .height(20)
                .fillColor('#CCCCCC')
            }
            .width('100%')
            .height(56)
            .padding({ left: 16, right: 16 })
            .backgroundColor('#FFFFFF')

            Divider().strokeWidth(1).color('#EDEDED')

            Row() {
              Text('æé†’è°çœ‹')
                .fontSize(16)
                .layoutWeight(1)

              Image($r('sys.media.ohos_ic_public_arrow_right'))
                .width(20)
                .height(20)
                .fillColor('#CCCCCC')
            }
            .width('100%')
            .height(56)
            .padding({ left: 16, right: 16 })
            .backgroundColor('#FFFFFF')

            Divider().strokeWidth(1).color('#EDEDED')

            Row() {
              Text('è°å¯ä»¥çœ‹')
                .fontSize(16)
                .layoutWeight(1)

              Text('å…¬å¼€')
                .fontSize(16)
                .fontColor('#999999')
                .margin({ right: 8 })

              Image($r('sys.media.ohos_ic_public_arrow_right'))
                .width(20)
                .height(20)
                .fillColor('#CCCCCC')
            }
            .width('100%')
            .height(56)
            .padding({ left: 16, right: 16 })
            .backgroundColor('#FFFFFF')
          }
          .width('100%')
          .margin({ top: 8 })
        }
      }
      .layoutWeight(1)
      .backgroundColor('#EDEDED')
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#EDEDED')
  }
}
