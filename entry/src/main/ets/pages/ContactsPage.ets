/**
 * é€šè®¯å½•é¡µ
 * åŠŸèƒ½ï¼šæ˜¾ç¤ºè”ç³»äººåˆ—è¡¨ï¼ŒæŒ‰å­—æ¯ç´¢å¼•æŽ’åº
 */
import router from '@ohos.router'

// è”ç³»äººæ•°æ®æ¨¡åž‹
class Contact {
  id: number
  name: string
  avatar: string
  letter: string // é¦–å­—æ¯

  constructor(id: number, name: string, avatar: string, letter: string) {
    this.id = id
    this.name = name
    this.avatar = avatar
    this.letter = letter
  }
}

@Entry
@Component
struct ContactsPage {
  @State currentTab: number = 1 // å½“å‰é€‰ä¸­çš„Tabï¼Œ1=é€šè®¯å½•
  @State searchText: string = ''
  @State contactList: Contact[] = [
    new Contact(1, 'é˜¿å¼º', '', 'A'),
    new Contact(2, 'é˜¿æ˜Ž', '', 'A'),
    new Contact(3, 'é™ˆå¤§', '', 'C'),
    new Contact(4, 'é™ˆå°', '', 'C'),
    new Contact(5, 'æŽå››', '', 'L'),
    new Contact(6, 'æŽé›·', '', 'L'),
    new Contact(7, 'çŽ‹äº”', '', 'W'),
    new Contact(8, 'å¼ ä¸‰', '', 'Z'),
    new Contact(9, 'èµµå…­', '', 'Z'),
  ]
  @State letterList: string[] = ['A', 'C', 'L', 'W', 'Z']

  // åŠŸèƒ½å…¥å£é¡¹ç»„ä»¶
  @Builder
  FunctionItem(icon: string, title: string, url: string) {
    Row() {
      Text(icon)
        .width(40)
        .height(40)
        .fontSize(24)
        .textAlign(TextAlign.Center)
        .backgroundColor('#F5F5F5')
        .borderRadius(8)
        .margin({ right: 12 })

      Text(title)
        .fontSize(16)
        .layoutWeight(1)

      Image($r('sys.media.ohos_ic_public_arrow_right'))
        .width(20)
        .height(20)
        .fillColor('#CCCCCC')
    }
    .width('100%')
    .height(60)
    .padding({ left: 16, right: 16 })
    .backgroundColor('#FFFFFF')
    .onClick(() => {
      router.pushUrl({ url: url })
    })
  }

  // è”ç³»äººé¡¹ç»„ä»¶
  @Builder
  ContactItem(contact: Contact) {
    Row() {
      Text(contact.name.substring(0, 1))
        .width(40)
        .height(40)
        .borderRadius(4)
        .backgroundColor('#07C160')
        .fontColor('#FFFFFF')
        .fontSize(16)
        .textAlign(TextAlign.Center)
        .margin({ right: 12 })

      Text(contact.name)
        .fontSize(16)
        .layoutWeight(1)

      Image($r('sys.media.ohos_ic_public_arrow_right'))
        .width(20)
        .height(20)
        .fillColor('#CCCCCC')
    }
    .width('100%')
    .height(60)
    .padding({ left: 16, right: 16 })
    .backgroundColor('#FFFFFF')
    .onClick(() => {
      router.pushUrl({ url: 'pages/ContactDetailPage' })
    })
  }

  build() {
    Column() {
      // é¡¶éƒ¨æ ‡é¢˜
      Row() {
        Text('é€šè®¯å½•')
          .fontSize(20)
          .fontWeight(FontWeight.Bold)

        Blank()

        Image($r('sys.media.ohos_ic_public_add'))
          .width(24)
          .height(24)
          .onClick(() => {
            router.pushUrl({ url: 'pages/AddFriendPage' })
          })
      }
      .width('100%')
      .height(56)
      .padding({ left: 16, right: 16 })
      .backgroundColor('#FFFFFF')

      // æœç´¢æ¡†
      Row() {
        Image($r('sys.media.ohos_ic_public_search_filled'))
          .width(20)
          .height(20)
          .fillColor('#999999')
          .margin({ right: 8 })

        TextInput({ placeholder: 'æœç´¢' })
          .layoutWeight(1)
          .backgroundColor('transparent')
          .onChange((value: string) => {
            this.searchText = value
          })
      }
      .width('90%')
      .height(36)
      .backgroundColor('#F5F5F5')
      .borderRadius(18)
      .padding({ left: 12, right: 12 })
      .margin({ top: 8, bottom: 8 })

      // è”ç³»äººåˆ—è¡¨
      List() {
        // åŠŸèƒ½å…¥å£
        ListItem() {
          Column() {
            this.FunctionItem('ðŸ‘¥', 'æ–°çš„æœ‹å‹', 'pages/NewFriendPage')
            Divider().strokeWidth(1).color('#EDEDED')
            this.FunctionItem('ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦', 'ç¾¤èŠ', 'pages/GroupListPage')
            Divider().strokeWidth(1).color('#EDEDED')
            this.FunctionItem('ðŸ·ï¸', 'æ ‡ç­¾', 'pages/TagPage')
          }
          .margin({ bottom: 8 })
        }

        // è”ç³»äººåˆ—è¡¨ï¼ˆæŒ‰å­—æ¯åˆ†ç»„ï¼‰
        ForEach(this.letterList, (letter: string) => {
          ListItemGroup({ header: this.GroupHeader(letter) }) {
            ForEach(this.contactList.filter(c => c.letter === letter), (contact: Contact) => {
              ListItem() {
                this.ContactItem(contact)
              }
            })
          }
        })
      }
      .width('100%')
      .layoutWeight(1)
      .backgroundColor('#EDEDED')

      // åº•éƒ¨å¯¼èˆªæ 
      Row() {
        // æ¶ˆæ¯
        Column() {
          Image($r('sys.media.ohos_ic_public_email'))
            .width(24)
            .height(24)
            .fillColor(this.currentTab === 0 ? '#07C160' : '#999999')
          Text('æ¶ˆæ¯')
            .fontSize(12)
            .fontColor(this.currentTab === 0 ? '#07C160' : '#999999')
            .margin({ top: 4 })
        }
        .layoutWeight(1)
        .onClick(() => {
          this.currentTab = 0
          router.back()
        })

        // é€šè®¯å½•
        Column() {
          Image($r('sys.media.ohos_ic_public_phone'))
            .width(24)
            .height(24)
            .fillColor(this.currentTab === 1 ? '#07C160' : '#999999')
          Text('é€šè®¯å½•')
            .fontSize(12)
            .fontColor(this.currentTab === 1 ? '#07C160' : '#999999')
            .margin({ top: 4 })
        }
        .layoutWeight(1)
        .onClick(() => {
          this.currentTab = 1
        })

        // å‘çŽ°
        Column() {
          Image($r('sys.media.ohos_ic_public_scan'))
            .width(24)
            .height(24)
            .fillColor(this.currentTab === 2 ? '#07C160' : '#999999')
          Text('å‘çŽ°')
            .fontSize(12)
            .fontColor(this.currentTab === 2 ? '#07C160' : '#999999')
            .margin({ top: 4 })
        }
        .layoutWeight(1)
        .onClick(() => {
          this.currentTab = 2
          router.pushUrl({ url: 'pages/DiscoverPage' })
        })

        // æˆ‘
        Column() {
          Image($r('sys.media.ohos_ic_public_device_phone'))
            .width(24)
            .height(24)
            .fillColor(this.currentTab === 3 ? '#07C160' : '#999999')
          Text('æˆ‘')
            .fontSize(12)
            .fontColor(this.currentTab === 3 ? '#07C160' : '#999999')
            .margin({ top: 4 })
        }
        .layoutWeight(1)
        .onClick(() => {
          this.currentTab = 3
          router.pushUrl({ url: 'pages/ProfilePage' })
        })
      }
      .width('100%')
      .height(60)
      .backgroundColor('#FFFFFF')
      .border({ width: { top: 1 }, color: '#EDEDED' })
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#EDEDED')
  }

  // åˆ†ç»„å¤´éƒ¨
  @Builder
  GroupHeader(letter: string) {
    Text(letter)
      .fontSize(14)
      .fontColor('#666666')
      .width('100%')
      .height(30)
      .backgroundColor('#F5F5F5')
      .padding({ left: 16 })
  }
}
